<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüé¨%3C/text%3E%3C/svg%3E" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ–æ—Ä–º—ã -->
    <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-2xl">
        <h1 class="text-3xl font-bold mb-6 text-center text-teal-400">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∏–ª—å–º</h1>
        
        <form id="add-movie-form" class="space-y-6">
            <!-- –ü–æ–ª–µ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ -->
            <div>
                <label for="movie-title" class="block text-sm font-medium text-gray-400 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</label>
                <input type="text" id="movie-title" name="title" required class="w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-colors">
            </div>

            <!-- –ü–æ–ª–µ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è -->
            <div>
                <label for="movie-description" class="block text-sm font-medium text-gray-400 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="movie-description" name="description" rows="4" required class="w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-colors"></textarea>
            </div>

            <!-- –ü–æ–ª–µ –¥–ª—è URL –ø–æ—Å—Ç–µ—Ä–∞ -->
            <div>
                <label for="movie-poster-url" class="block text-sm font-medium text-gray-400 mb-1">URL –ø–æ—Å—Ç–µ—Ä–∞</label>
                <input type="url" id="movie-poster-url" name="posterUrl" required class="w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-colors">
            </div>

            <!-- –ü–æ–ª–µ –¥–ª—è URL –≤–∏–¥–µ–æ -->
            <div>
                <label for="movie-video-url" class="block text-sm font-medium text-gray-400 mb-1">URL –≤–∏–¥–µ–æ</label>
                <input type="url" id="movie-video-url" name="videoUrl" required class="w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 transition-colors">
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <button type="submit" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg shadow-teal-500/30">
                –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º
            </button>
        </form>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="notification" class="fixed bottom-6 right-6 p-4 rounded-lg shadow-lg text-white transition-opacity duration-300 opacity-0 hidden z-50">
        <p id="notification-message"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDoc, getDocs, doc, setDoc, updateDoc, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Firebase, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥–æ–π Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyB5X84s9PgkmnKt9nsNlsl5-mRyI06hexM",
            authDomain: "hate-studio.firebaseapp.com",
            projectId: "hate-studio",
            storageBucket: "hate-studio.firebasestorage.app",
            messagingSenderId: "862900757077",
            appId: "1:862900757077:web:ea1652b558a04235b1eadc",
            measurementId: "G-29V6NXRXMN"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const addMovieForm = document.getElementById('add-movie-form');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        
        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const authenticateUser = async () => {
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:", error);
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        const showNotification = (type, message) => {
            notificationMessage.textContent = message;
            if (type === 'success') {
                notification.classList.remove('bg-red-500');
                notification.classList.add('bg-green-500');
            } else {
                notification.classList.remove('bg-green-500');
                notification.classList.add('bg-red-500');
            }
            notification.classList.remove('hidden', 'opacity-0');
            notification.classList.add('opacity-100');
            setTimeout(() => {
                notification.classList.remove('opacity-100');
                notification.classList.add('opacity-0');
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 300);
            }, 3000);
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        addMovieForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
            const movieData = {
                title: document.getElementById('movie-title').value,
                description: document.getElementById('movie-description').value,
                posterUrl: document.getElementById('movie-poster-url').value,
                videoUrl: document.getElementById('movie-video-url').value,
                type: 'movie', // –£–∫–∞–∑—ã–≤–∞–µ–º —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                createdAt: new Date() // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏
            };
            
            try {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é 'films'
                await addDoc(collection(db, 'films'), movieData);
                showNotification('success', '–§–∏–ª—å–º —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                addMovieForm.reset(); // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏–ª—å–º–∞:", error);
                showNotification('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏–ª—å–º–∞.');
            }
        });

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        authenticateUser();
    </script>
</body>
</html>
